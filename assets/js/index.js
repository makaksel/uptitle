(()=>{"use strict";document.addEventListener("DOMContentLoaded",(function(){const e=["economic","law","philosophy","history"],t=document.getElementById("publishing-house"),c=document.getElementById("publishing-addition"),r=document.getElementById("onPayButton"),o=document.querySelectorAll(".card");-1!=navigator.userAgent.indexOf("Safari")&&-1==navigator.userAgent.indexOf("Chrome")&&document.body.classList.addClass("safari");const n=e=>e?e.toLocaleString("ru"):null,a=e=>{const t=e.closest(".block").querySelectorAll(".card.active"),c=[];t.forEach((e=>c.push(e.id))),e.value=c.join(",")};let s=0;const l=()=>{const e=document.getElementById("stepper").querySelectorAll(".stepper__step");t?.value||c?.value||(s=0),(t?.value||c?.value)&&(s=1),t?.value&&c?.value&&(s=2),e.forEach(((e,t)=>{s>=t?e.classList.add("finish"):e.classList.remove("finish")}))},i=document.querySelector(".footer__price .footer__price-small"),d=document.querySelector(".footer__price .footer__price-big"),u=document.querySelector(".payment__actions .price .price__small"),m=document.querySelector(".payment__actions .price .price__big"),y=()=>{const e=[t?.value,c?.value].join(",").split(",").reduce(((e,t)=>{const c=document.getElementById(t);if(!c)return e;const r=c.querySelector(".card__price-small")?.innerHTML,o=c.querySelector(".card__price-big")?.innerHTML;return{...e,small:e.small+parseInt(r.replace(/ /g,"")),big:e.big+parseInt(o.replace(/ /g,""))}}),{small:0,big:0}),r=n(e.small)?`${n(e.small)} ₽`:"",o=n(e.big)?`${n(e.big)} ₽`:"";i.innerHTML=r,d.innerHTML=o,u.innerHTML=r,m.innerHTML=o},p=r=>{const o=document.getElementById(r),n=o.querySelector(".card__action .btn");if(o.classList.contains("active")){if(e.includes(r)){const t=o?.closest(".block__table").querySelectorAll(".card"),c=Array.from(t)?.filter((t=>e.includes(t.id)));c.forEach((e=>{const t=e.querySelector(".btn-checked");t&&(t.innerHTML="Выбрать",t.classList.remove("btn-checked")),e.classList.remove("active"),e.classList.remove("card_disabled")}))}else n.classList.remove("btn-checked"),n.innerText="Выбрать",o.classList.remove("active");return a(t),a(c),L(),y(),void l()}if(e.includes(r)){const t=o?.closest(".block__table").querySelectorAll(".card"),c=Array.from(t)?.filter((t=>r!==t.id&&e.includes(t.id)));c.forEach((e=>{const t=e.querySelector(".btn-checked");t&&(t.innerHTML="Выбрать",t.classList.remove("btn-checked")),e.classList.remove("active"),e.classList.add("card_disabled")}))}n.classList.add("btn-checked"),n.innerText="",o.classList.remove("card_disabled"),o.classList.add("active"),a(t),a(c),L(),y(),l()},v=e=>{if(e.target.closest(".card__header")||e.target.closest(".card__modal"))return;const t=e.currentTarget.closest(".card"),c=t?.id;p(c)};o.forEach((e=>e?.addEventListener("click",v)));const f=document.querySelectorAll('.modal[data-modal-name="main"] .checkbox-button .checkbox-button__input'),h=t=>{const c=t.currentTarget,r=c?.id.replace("Check","");if(c.checked&&e.includes(r)){const t=c?.closest(".checkbox-group__table").querySelectorAll(".checkbox-button__input"),r=Array.from(t)?.filter((t=>e.includes(t.id.replace("Check",""))));r.forEach((e=>{e.checked=!1})),c.checked=!0}p(r)};f.forEach((e=>e?.addEventListener("click",h)));const _=e=>{const r=e.currentTarget,o=r?.dataset.choiceTarget,n=r.closest(".modal");[t?.value,c?.value].join(",").split(",").includes(o)||p(o),document.body.style.overflow="",n?.classList.remove("open")};document.querySelectorAll(".choice-in-modal .choice-in-modal__btn").forEach((e=>e?.addEventListener("click",_)));const L=()=>{const e=document.querySelector('.tinkoffPayRow[name="amount"]'),t=document.querySelectorAll(".card.active .card__price-big"),c=Array.from(t).reduce(((e,t)=>{const c=t.innerHTML;return e+parseInt(c.replace(/ /g,""))}),0);r.disabled=!c,e.value=c},g=document.getElementById("persone-form2"),b=document.getElementById("contacts"),S=e=>{const t=e.querySelectorAll('input[required][type="text"]'),c=e.querySelectorAll('input[required][type="checkbox"]'),r=Array.from(t).filter((e=>!e.value)),o=Array.from(c).filter((e=>!e.checked));return r.forEach((e=>{const t=e.closest(".text-input");if(t.classList.contains("error"))return;const c=document.createElement("span");c.classList.add("text-input__error-text"),c.append("Поле не заполнено"),t?.classList.add("error"),t.append(c),e.addEventListener("input",(()=>{t?.classList.remove("error"),t.querySelector(".text-input__error-text")?.remove()}))})),o.forEach((e=>{const t=e.closest(".checkbox");t.classList.add("error"),e.addEventListener("change",(()=>{t?.classList.remove("error"),t.querySelector(".text-input__error-text")?.remove()}))})),0===r.length&&0===o.length},q=document.querySelectorAll(".modal .btn-consultation"),E=async e=>{const t=e.currentTarget,c="contacts"===t.closest(".modal").dataset.modalName?b:g;if(!S(c))return;t.classList.remove("success"),t.classList.add("loading");const r=c.querySelectorAll(".text-input__input"),o=(Array.from(r).reduce(((e,t)=>({...e,[t.name]:t.value})),{}),data?.name,data?.phone,data?.email,new Promise((e=>{setTimeout((()=>e()),500)})));try{await o}catch(e){console.error(e)}t.classList.remove("loading"),t.classList.add("success")};q?.forEach((e=>e?.addEventListener("click",E))),r.addEventListener("click",(async()=>{if(!S(g))return;r.classList.remove("success"),r.classList.add("loading");const e=Math.floor(Math.random()*Date.now()),t=document.querySelector('.tinkoffPayRow[name="amount"]'),c=g.querySelectorAll(".text-input__input"),o=Array.from(c).reduce(((e,t)=>({...e,[t.name]:t.value})),{}),n=document.querySelectorAll(".card.active");let a=[];n.forEach((e=>{const t=e.querySelector(".card__title")?.innerHTML;t&&a.push(t.replaceAll(",",""))}));const s=`Список услуг: ${a.join(";")}`,l=`${t?.value}00${s}${e}terminalPassterminalKey`,i=(await(async e=>{const t=(new TextEncoder).encode(e),c=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(c)).map((e=>e.toString(16).padStart(2,"0"))).join("")})(l),o?.name,o?.phone,o?.email,a.reduce(((e,t)=>e+`${t};\n`),""),o?.name,o?.phone,o?.email,t?.value,new Promise((e=>{setTimeout((()=>e()),500)})));try{await i}catch(e){console.error(e)}r.classList.remove("loading"),r.classList.add("success")}));const k=e=>{const r=e.currentTarget?.dataset.modalTarget;"main"===r&&(()=>{const e=[t?.value,c?.value].join(",").split(",");f.forEach((t=>{t.checked=e.includes(t.id.replace("Check",""))}));const r=document.querySelectorAll("#persone-form2 .text-input__input");Array.from(r).forEach((e=>{const t=document.querySelector(`#persone-form input[name="${e.name}"]`);e.value=t.value}))})();const o=document.querySelector(`.modal[data-modal-name="${r}"]`);document.body.style.overflow="hidden",o?.classList.add("open")},A=e=>{const t=e.currentTarget?.closest(".modal");document.body.style.overflow="",t?.classList.remove("open")},w=document.querySelectorAll("[data-modal-target]"),x=document.querySelectorAll(".modal .modal__close");w.forEach((e=>e?.addEventListener("click",k))),x.forEach((e=>e?.addEventListener("click",A))),window?.addEventListener("keydown",(e=>{if("escape"===e?.key?.toLowerCase()){const e=document.querySelector(".modal.open");e?.classList.remove("open"),document.body.style.overflow=""}})),a(t),a(c),L(),y(),l();const T=(e=>{let t=RegExp("[?&]payment-result=([^&]*)").exec(window.location.search);return t&&decodeURIComponent(t[1].replace(/\+/g," "))})();(()=>{if(!T)return;const e="success"===T?"result-payment-success":"result-payment-failure",t=document.querySelector(`.modal[data-modal-name="${e}"]`),c=new URL(document.location);c.searchParams.delete("payment-result"),window.history.pushState({},"",c.toString()),t&&(document.body.style.overflow="hidden",t.classList.add("open"))})()}))})();